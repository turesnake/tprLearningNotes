# ================================================================ #
#            Burst 编译优化技术
# ================================================================ #
jobs 系统使用 Burst 编译器来实现优化. 


# ---------------------------------------------- #
#     使用 Unity.Mathematics 替代 unity 自带的数学库
# ---------------------------------------------- #

using Unity.Mathematics;
using static Unity.Mathematics.math;



# ---------------------------------------------- #
#     burst 会尽可能地展开 函数调用
# ---------------------------------------------- #
这是自动发生的. 



# ---------------------------------------------- #
#     使用 floor() 代替 int地板除: /
# ---------------------------------------------- #
int 地板除: / 无法被 Burst "向量化", 

改用 Mathematics.math.floor() 


# ---------------------------------------------- #
#     int 取余运算%  无法被 "向量化"
# ---------------------------------------------- #
需要用别的方法间接实现之;

    float4 a;
    int freq;

# 本来希望实现: int4 c = (int4)a % freq;
# 现在可改写为:

    a -= (int4)(a/(float)freq) * freq;

    借用 float 的除法, 然后再强制转换为 int, 在这个过程中会实现类似 floor 的效果
    (当然, 也可使用专门的 math 运算)
    然后就能计算出 余数


# ---------------------------------------------- #
#    auto-vectorization "自动向量化"
# ---------------------------------------------- #
可能存在问题的描述:
    在 job for 循环中, 一些针对 简单类型(float,int) 的操作,
    可能会以 4个为一组 被组成一个 向量, 然后使用 SIMD 指令并行运算之.

    若在 job 代码中使用了 分量数为4 的向量, 比如 float4, 可自动享受 "向量化"

    若使用的向量的分量数不为 4, 比如 float3, float3x4 这种, 则 "自动向量化" 将失效.
    此时可以手动实现 "向量化"... 
        说白了就是从头到尾都把数据捆绑为 4个float, 4个int 去处理





# ---------------------------------------------- #
#    位运算: rotate-Left
# ---------------------------------------------- #

    uint RotateLeft (uint data, int steps)
    {
        (data<<steps) | (data >> 32-steps);
    }

    就是把一个 uint 数往左移动,溢出去的几位, 填到 右侧区域去.

存在现成的 rotate-Left cpu指令. Burst 可以识别出上述这段代码, 并用 ROL 指令自动取代这段代码.
但是, ROL 指令不支持 "向量化", 所以, 如果想要支持 "向量化" (从而优化性能), burst 也可选择
使用上述代码: 两个 shift 操作 + 一个 | 操作. 



# ---------------------------------------------- #
#    与 const 0 相乘的片段
# ---------------------------------------------- #
一个运算表达式可以很长, 或者很复杂(比如向量乘向量)
中间会出现与 const 0 相乘的部分.

这些部分都会被 burst 优化掉. 





