
# ================================================== #
#               C#   异步编程
# ================================================== #

https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/



# ============================= #
#   unity 对 async/await 的支持
# ============================= #
https://docs.unity3d.com/2021.3/Documentation/Manual/overview-of-dot-net-in-unity.html

按照上面文档的内容, unity 不太推荐;



# ================================== #
#            正式教程
# ================================== #

至少按照 图解 一书的描述;
异步编程 并不一定是在多线程; 

# 异步编程 的核心目的是 不阻塞主线程,  是否使用多线程只是一种实现方式;
    协程其实也能实现相同的目标;

    只有调用 await Task.Run(...); 之类的显示产生多线程的语句时, 才会产生多线程;




# 三种返回类型:

# -- async void YY();
    YY();
    ...

YY() 调用之后, 不管 YY 函数内部耗时如何, 将立刻执行其下方的语句, 从此再也不关心 YY() 这次调用何时结束;



# -- async Task KK();
    Task ret = KK();
    ....
    ret.Wait();
    ...

和上面的 void 类似, 本类型也不返回实质返回值; 但是可在后续代码中, 通过 ret.Wait(); 来强制等待 KK() 被执行完毕;


# -- async Task<int> PP();
    Task ret = PP();
    ...
    int some = ret.Result;

可通过 ret.Result; 等待并拿到返回值;



# ---------------------- #
#       await
# ---------------------- #
具体查看 图解 一书的介绍;

在一个异步函数中, 从头部开始一直到第一个 await 语句, 这一段其实都是在原有线程(流程)里执行的;

从第一个 await 语句开始, 这个异步函数将被拆开, 
    -1- await 语句执行完后, 将立刻从 异步函数 返回, 然后去执行 异步函数调用 后面的代码;
    -2- 异步函数内, await 语句后的内容, 将被包装成一个 "后续部分"; 一直到 await 语句执行完了, 这个 "后续部分" 才开始被执行;
        而且 "后续部分" 和 外边的 主流程 是同时被执行的, 两者的顺序是彻底打乱的 (可以理解为两个平行线程);

 


# ---------------------- #
#    Task.Run( lambda... );
# ---------------------- #
await Task.Run( lambda... );

Task.Run() 里要执行的内容, 是在别的线程上执行的;



# ---------------------- #
#      Wait
#      WaitAll
#      WaitAny
#     Task.WhenAll(...)    -- 异步等待
#     Task.WhenAny(...)    -- 异步等待
# ---------------------- #
有多种等待方式; 暂未展开



# ---------------------- #
#   await Task.Delay(1000);
# ---------------------- #

等待;


# ---------------------- #
#   await Task.Yield();
# ---------------------- #

此时, await 语句本身没啥要执行的, 只是人为拆分出一个 异步块 出来; 



# ---------------------- #
#   BackgroundWorker calss
# ---------------------- #
后台线程类











